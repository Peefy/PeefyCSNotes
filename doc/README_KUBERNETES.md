
# Kubernetes(k8s)笔记

生产级容器编排调度与管理，[Github项目链接](https://github.com/kubernetes/kubernetes)

Kubernetes是一个开源系统，用于跨多个主机管理容器化的应用程序。它提供了用于部署，维护和扩展应用程序的基本机制。Kubernetes由云原生计算基金会（CNCF）托管。如果公司希望帮助塑造容器包装，动态调度和面向微服务的技术的发展，请考虑加入CNCF。

Kubernetes 脱胎于 Google 的 Borg 系统，是一个功能强大的容器编排系统。Kubernetes 及其整个生态系统（工具、模块、插件等）均使用 Go 语言编写，从而构成一套面向 API、可高速运行的程序集合，这些程序文档精良、易于参与贡献或在其上构建应用程序。

[k8s官方文档](https://kubernetes.io/docs/tutorials/kubernetes-basics/)

## Kubernetes基础

教程的作用：

* 在集群上部署容器化的应用程序。
* 扩展部署。
* 使用新的软件版本更新容器化的应用程序。
* 调试容器化的应用程序。

使用现代的Web服务，用户希望应用程序可以24/7全天候可用，而开发人员则希望每天多次部署这些应用程序的新版本。容器化有助于打包软件来实现这些目标，从而使应用程序可以轻松快速地发布和更新，而无需停机。**Kubernetes**可帮助确保那些容器化的应用程序在所需的位置和时间运行，并帮助他们找到工作所需的资源和工具。**Kubernetes是一个可投入生产的开放源代码平台**

## 创建集群

Kubernetes协调连接在一起作为单个单元工作的高可用性计算机集群。Kubernetes中的抽象允许将容器化的应用程序部署到集群，而无需将它们专门绑定到单个机器。为了利用这种新的部署模型，需要以一种将应用程序与各个主机分离的方式打包应用程序：它们需要进行容器化。容器化的应用程序比过去的部署模型更加灵活和可用，在过去的部署模型中，将应用程序直接安装在特定的计算机上，而程序包已与主机深度集成。Kubernetes以更有效的方式自动在整个集群中分配和调度应用程序容器。

Kubernetes集群包含两种类型的资源：

* 主坐标的集群
* 节点是运行应用程序的工作程序

**主机负责管理群集**。主服务器协调集群中的所有活动，例如调度应用程序，维护应用程序的所需状态，扩展应用程序以及推出新的更新。

**节点是充当Kubernetes集群中的辅助计算机的VM或物理计算机**。每个节点都有一个Kubelet，它是用于管理节点并与Kubernetes主节点通信的代理。该节点还应该具有用于​​处理容器操作的工具，例如Docker或rkt。处理生产流量的Kubernetes集群至少应具有三个节点。

在Kubernetes上部署应用程序时，告诉主机启动应用程序容器。主服务器计划容器在群集的节点上运行。**节点使用主机公开的Kubernetes API与主机进行通信**。最终用户还可以直接使用Kubernetes API与集群进行交互。

Kubernetes集群可以部署在物理机或虚拟机上。要开始Kubernetes开发，可以使用**Minikube**。**Minikube**是一种轻量级的Kubernetes实现，可在本地计算机上创建VM并部署仅包含一个节点的简单集群。**Minikube**可用于Linux，macOS和Windows系统。Minikube CLI提供了用于引导群集的基本引导程序操作，包括启动，停止，状态和删除。

## 部署应用

### 使用`kubectl`创建部署

拥有运行中的Kubernetes集群后，可以在其之上部署容器化的应用程序。为此，将创建一个Kubernetes 部署配置。部署指示Kubernetes如何创建和更新应用程序实例。创建部署后，Kubernetes主节点将调度该部署中包含的应用程序实例，使其在集群中的各个节点上运行。

创建应用程序实例后，Kubernetes部署控制器将持续监视这些实例。如果承载实例的节点发生故障或被删除，则部署控制器将实例替换为群集中另一个节点上的实例。这提供了一种**自我修复机制**来解决机器故障或维护。

在编排前的世界中，安装脚本通常用于启动应用程序，但是它们不允许从计算机故障中恢复。通过创建应用程序实例并使它们在节点上运行，Kubernetes部署为应用程序管理提供了根本不同的方法。

可以使用Kubernetes命令行界面Kubectl创建和管理部署。Kubectl使用Kubernetes API与集群进行交互。创建部署时，需要为应用程序指定容器映像以及要运行的副本数。

## 探索应用

### 查看窗格Pods和结点Nodes

在创建部署时，Kubernetes将创建一个Pod来承载应用程序实例。Pod是Kubernetes的抽象，代表一组一个或多个应用程序容器（例如Docker或rkt）以及这些容器的一些共享资源。这些资源包括：

* 共享存储（作为卷）
* 联网，作为唯一的群集IP地址
* 有关如何运行每个容器的信息，例如容器映像版本或要使用的特定端口

Pod为特定于应用程序的“逻辑主机”建模，并且可以包含相对紧密耦合的不同应用程序容器。例如，一个Pod可能同时包含带有Node.js应用程序的容器以及一个不同的容器，该容器将提供要由Node.js Web服务器发布的数据。Pod中的容器共享一个IP地址和端口空间，它们始终位于同一位置并共同调度，并在同一节点上的共享上下文中运行。

吊舱是Kubernetes平台上的原子单元。当在Kubernetes上创建Deployment时，该Deployment将在Pod中创建内部包含容器的Pod（与直接创建容器相反）。每个Pod都绑定到计划的节点上，并保持在那里，直到终止（根据重新启动策略）或删除为止。如果节点发生故障，则会在群集中的其他可用节点上调度相同的Pod。

Pod始终在Node上运行。节点是Kubernetes中的工作机，并且可以是虚拟机或物理机，具体取决于集群。每个节点由主节点管理。一个节点可以有多个Pod，Kubernetes主节点会自动处理跨集群中所有Node调度Pod的过程。主节点的自动调度考虑了每个节点上的可用资源。如果容器紧密耦合并且需要共享磁盘之类的资源，则仅应在单个Pod中一起计划容器。

每个Kubernetes节点至少运行：

* Kubelet，一个负责Kubernetes Master与Node之间通信的过程；它管理Pods和在机器上运行的容器。
* 容器运行时（例如Docker，rkt）负责从注册表中提取容器映像，解压缩容器并运行应用程序。

### 使用Kubectl进行故障排除

可以使用以下kubectl命令完成最常见的操作：

* **kubectl get**-列表资源
* **kubectl describe**-显示有关资源的详细信息
* **kubectl logs**-从容器中的容器中打印日志
* **kubectl exec**-在容器中的容器上执行命令

可以使用这些命令来查看应用程序的部署时间，它们的当前状态，运行的位置以及它们的配置。

