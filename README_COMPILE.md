## 编译原理

高级程序设计语言编译程序的构造原理，词法分析、语法分析、语义分析以及目标代码的生成和优化

以c语言为背景，计算机之所以能如此广泛的应用，当归功于高级程序设计语言，而编译程序的存在，使高级程序设计语言具有永恒的生命力。

**总论**

高级程序设计语言的引进，使人们能用接近于数学用语的表示法去表达算法，高级语言明显的优点为：接近于数学表示法，因而易读易理解；与具体机器无关。高级程序是符号语言，任何程序归根结底总是一个字符序列，其中包括英文字母、数字、运算符、括号以及标点符号等。计算机能直接理解的只能是二进制机器代码

从高级语言到机器可以直接接受和运行的二进制代码程序，这个翻译就是编译程序

编译原理=形式语言理论+编译技术

编译程序可以看做是程序设计语言的支持工具或环境。在编译程序的支持下，高级语言程序才可能得以运行

编译原理的内容：
* 高级程序设计语言
* 与实现编译有关的形式语言理论基本概念
* 构造编译程序的基本概念、原理和技术

编译程序构造原理又包括词法分析、语法分析、语义分析、目标代码生成与代码优化等

任何高级程序设计语言的书写总是按照一定的架构组成的。一般C程序的结构成分按概念层次由小到大可表示为：
*基本符号-符号(单词)-量-表达式-说明与语句-函数定义-程序*

程序是由一连串基本符号组成的。C语言的基本符号可以是字母、数字与界限符等。字母包括a,b,...,z,A,B,...,Z,数字包括0,1,...,9,界限符包括关键字(如char与if)和专用符号两类。专用符号可以是运算符(如+与-)、括号(如{与})、分隔符(如赋值号与语句结尾分号等)

程序设计语言的四个方面
* 语法  是指如何由程序设计语言基本符号组成程序中各个语法成分(包括程序)的一组规则，其中由符号（单词）的书写规则称为词法规则。
* 语义  是程序设计语言中按语法规则所构成的各个语法成分的意义。语义通常用非形式的口语描述
* 语用  表示语言符号及其使用者之间的关系，涉及符号的来源
* 语境  是指理解和实现程序设计语言的环境，这种环境因此包括编译环境与运行环境。语境的不同将影响到语言的实现。例如，c语言整型量通常占用2个字节，若占用4个字节，C程序的书写与运行将有很大的不同。显然，同一种程序设计语言的易移植性受语境所影响

**语法图**

<img src="https://github.com/Peefy/PeefyCSNotes/tree/master/imgs/Syntaxdiagram.png"/>

图中长方框表示语法成分，其他框表示将出现在程序中的符号。弧表示后继关系，例如，数据类型后继以函数标识符号、函数标识符号后继以圆括号，语法图中描述了四类因式，即无正负号常量、变量、用圆括号括住的表达式以及函数引用(调用)

语法图的优点是形象直观；不足是不紧凑，篇幅较大，尤其因为是非形式的，不利于语法分析程序自动生成

**BHF表示法**

BNF表示法是语法规则的形式表示系统，其中规则取如下形式。

<函数定义>::=<函数首部><函数体>
<函数定义>定义为<函数首部>后跟以<函数体>。至于<函数首部>则定义为：
<函数首部>::=<数据类型><函数标识符>(<形参表列>)
<函数首部>::=<数据类型><函数标识符>(<形参表列>|<数据类型>)<函数标识符>()

BNF表示法是描述程序设计语言的形式体系，这时引入一些新的元符号，即花括号{与},
方括号\[与\],以及圆括号(与),称扩充的BNF表示法.

当然也可以用*口语*方式定义的语法，但是往往显得不简洁，不直观

**程序执行**

高级语言程序通常可采用两种方式执行，即*解释方式*与*翻译方式*,解释执行借助于解释程序来完成。

解释方式执行程序的优点是易于查错，因为若存在错误，总可以立即从正在模拟执行的程序中确定出错语句的位置。

翻译执行借助于一个翻译程序来完成。翻译程序对整个程序进行分析，翻译成等价的机器语言(或汇编语言)程序，然后执行。所谓等价是两者的执行效果完全一致。源程序经编译程序后变成机器可执行的目标程序。

若目标程序是汇编语言程序，在运行前者首先要由汇编程序将其翻译成等价的机器语言代码。通常不明确是机器语言还是汇编语言的目标程序，统称为目标程序，也称为目标机器代码

编译方式执行源程序的优点是只需分析与翻译源程序一次，一旦获得目标程序便可以反复运行，而不必重新翻译，

但是BASIC与FOXPRO等语言，提供解释与编译两种执行方式，调试时采用解释方式，一旦排除错误，再采用编译方式

*编辑、编译、运行、调试*

**编译程序构造及有关概念**

编译程序的功能是把高级语言源程序翻译成等价的低级语言目标程序，而源程序是由基本符号序列组成，这些基本符号并不一定具有独立的含义，如字母与数字等，而且可能是由若干字符组成
如main由4个字母组成

编译程序的构造可以分为*前端*和*后端*两部分
* 前端：前端完成分析，词法分析、语法分析、语义分析
* 后端：后端完成综合，目标代码生成与代码优化
各部分的功能
> 详细介绍如下
* **词法分析** 编译程序分析工作从词法分析开始，完成词法分析工作的部分称词法分析程序，又称扫描程序 
* **语法分析** 完成语法分析的部分称语法分析程序，又称识别程序。读入由词法分析程序识别出的符号，根据给定的语法规则，识别出各个各个语法结构。在进行语法分析时，识别出语法结构的同时也就检查了语法的正确性
* **语义分析** 语义分析工作由一些语义子程序完成，这些语义子程序对语法分析树或其他内部中间表示进行静态语义检查并生成目标代码。因此内部中间表示代码是语义分析的产物，它可以是抽象语法树，但更经常生成的是逆波兰表示、三元式序列与四元式序列
* **代码优化** 是指编译时刻为改进目标代码质量而进行的各项工作。
* **目标代码生成** 目标代码可以在语义分析时生成，如果语义分析的结果是中间表示代码，就必须把中间表示代码变换成等价的目标程序，即目标语言代码

综上所述：一个编译程序由前端和后端组成，前端进行分析，完成词法分析、语法分析与语义分析，后端进行综合，完成目标代码的生成与代码优化。

前端一般是与机器无关的，而后端一般是与机器相关的。

**编译程序的分类**

* 诊断型编译程序：此类编译程序专门设计出来帮助开发与调试程序，它们仔细地检查程序，发现程序中的错误，往往能自动校正一些小错误 ，例如遗漏逗号或括号等.
* 优化型编译程序：此类编译程序专门设计出来以产生高功效的机器代码，其代价是增加编译程序复杂性与编译时间。 功效指时空功效，即期望目标程序占用的存储空间少，而运行时间短.
* 可重定目标型编译程序：通常一个编译程序是为一个特定的程序设计语言和一种特定的目标计算机而设计的，从源程序编译生成的目标程序只能在某种特定计算机上运行.
* 交叉型编译程序：通常运行由编译程序生成的目标程序的计算机应与运行编译程序的计算机具有相同的型号。
* 增量型编译程序：通常编译程序对一个源程序进行编译时发现源程序中存在错误 ，便进行修改 ，然后从头开始重新编译。

总结：高级程序设计语言程序的执行通常有解释与翻译两种方式。把高级程序设计语言程序翻译成等价的低级语言目标程序的翻译程序称编译程序。由于高级程序设计语言归根结底是字符序列或基本符号序列，编译程序实质上是一种符号处理工具。按照用途与侧重面，存在有若干种不同种类的编译程序。

**文法与语言**

当不考虑含义时，程序设计语言是一种符号语言，具有一般形式语言的共同特征。

**字母表、符号串**

字母表是有穷非空的符号集合。字母表包含了语言中所孕育出现的一切符号，当然其中至少要包含一个符号。显然，对于不同的语言可以有不同的字母表。例如二进制数语言的字母表{0,1},而对于C语言，字母表可以说是一切可打印字符组成的集合，也可以把基本符号集合看成该语言的字母表。由于字母表示符号的有穷集合，通常在字母表的集合表示中把一切符号明确写出

符号串是由字母表中的符号所组成的有穷序列，符号串x中所包含符号的个数称为符号串x的长度，用|x|表示。例如符号串abc的长度|abc|=3,而符号串010110的长度|010110|=6

子符号串，符号串的运算：联结

符号串集合：若集合A中的一切元素都是某字母表∑上的符号串，则称A为该字母表∑上的符号串集合

字母表上的符号串集合通常用大写英文字母A、B、C、...表示。例如用B表示字母表{0,1}上的符号串集合，即二进制数集合。

符号串集合的运算：交集、并集、补集，集合卡式积等。

字母表的闭包与正闭包：由于一个字母表的正闭包包含了该字母表中的符号所能组成的一切符号串，而语言是该字母表上的某个符号串集合，因此，在某个字母表上的语言是该字母表的正闭包的子集，且是真子集

**重写规则**

一个重写规则是一个有序对(U,u),通常写作U::=u,其中U是一个符号，称为重写规则的左部，而u是有穷非空符号串，称为重写规则的右部

形如U::=V(U,V都是非终结符号)的规则称为单规则。<标识符>::=<字母>

当若干个规则的左部是相同的非终结符号时，对这些规则可采用缩写的形式，
<标识符>::=<字母>|<标识符><字母>|<标识符><数字>

<字母>::=A|B|C
<数字>::=0|1|2

“|”表示“或”，<标识符>有3个选择，即<字母>、<标识符><字母>或<标识符><数字>

通常把BNF表示法称为元语言，符号“::=”与“|”等称为元语言连接符。当在规则中使用各种括号作为元语言符号时间，则沿用了扩充BNF表示法

**文法**

文法G\[Z\]是有穷非空的重写规则集合，其中Z是识别符号，而G是文法名。
定义2.13 文法G的字汇表V=VnVt,即自汇表示出现于文法规则中的一切符号所组成的集合

设G\[Z\]是一文法，如果符号串x是从识别符号Z推导所得的

**语言的形式定义**

假定G\[Z\]是一文法，由该文法描述的语言用L(G\[Z\])表示，则有如下定义.
如果一个规则形如U::=...U...,则称规则是递归的；如果规则形如U::=U...,则称左递归的；
如果形如U::=...U,则称右递归的。如果对于某文法，存在非终结符号U,对于它,U=>+ ...U...,则称该文法递归于U；如果U=>+U...,则称文法左递归于U；如果U=>+ ...U,则称该文法右递归于U.

C语言中左递归规则有：
* <标识符表>::=<标识符表>,<标识符>
右递归规则有
* <因式>::=!<因式>
C语言文法右递归于<语句>,因为有
* <语句>::=<构造语句>
* <构造语句>::=<条件语句>
* <条件语句>::=if(<布尔表达式>)<语句> else<语句>

**词法分析**

**语法分析----自顶向下分析技术**

**语法分析----自底向上分析技术**

**语义分析与目标代码生成**

**运行环境**

**代码优化**

**程序错误的检查和校正**

